// Bundled with webpack.
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(()=>(()=>{"use strict";var __webpack_modules__={156:(module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});const parser_1=__webpack_require__(56),lexer_1=__webpack_require__(345),jsGen_1=__webpack_require__(134);function transpile(e,t,r){const n=new parser_1.default(e).produceAST();return new jsGen_1.default(n).transpile("generator",!0,t,r)}function preCompile(e,t,r){const n=new parser_1.default(e).produceAST();return"(yield* (function*($globalEnv, $target){"+new jsGen_1.default(n).transpile("string",!0,t,r)+"})(runtime.ext_vgspenguinscript._globalEnv, target))"}function*log(...e){return console.log(...e),null}function*warn(...e){return console.warn(...e),null}function*error(...e){return console.error(...e),null}function supportsNullishCoalescing(){try{return eval("true ?? 0")}catch(e){return!1}}jsGen_1._globalEnv.__env.set("print",{get value(){return log}}),jsGen_1._globalEnv.__env.set("warn",{get value(){return warn}}),jsGen_1._globalEnv.__env.set("error",{get value(){return error}});const canNullish=supportsNullishCoalescing();let Scratch;if("object"==typeof window&&window&&"object"==typeof window.document&&"object"==typeof(Scratch=window.Scratch)&&Scratch){if(!Scratch.extensions.isPenguinMod)throw"Please load PenguinScript in PenguinMod";function*e(e){if("string"!=typeof e)throw new TypeError("Attempted to get sprite with name, but name is not a string");return Scratch.vm.runtime.getSpriteTargetByName(e)}function*t(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x position of non-sprite to "+Number(t));const r=Number(t)||0;return e.setXY(r,e.y,!1),null}function*r(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set y position of non-sprite to "+Number(t));const r=Number(t)||0;return e.setXY(e.x,r,!1),null}function*n(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x and y position of non-sprite to "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setXY(n,s,!1),null}function*s(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x position of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.x+r,e.y,!1),null}function*o(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change y position of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.x,e.y+r,!1),null}function*i(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x and y position of non-sprite by "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setXY(e.x+n,e.y+s,!1),null}function a(e){return e*Math.PI/180}function c(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot move a non-sprite by "+Number(t)+" steps");Number(t);const n=r??e.direction,s=e.direction;e.setDirection(Number(n)||0);const o=e.direction;e.setDirection(s);const i=o*Math.PI/180,a=t*Math.cos(i),c=t*Math.sin(i);e.setXY(e.x+a,e.y+c)}function*l(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set or change direction of a non-sprite");const r=Number(t)||0;return e.setDirection(r),null}function*p(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set or change direction of a non-sprite");const r=Number(t)||0;return yield*l(e,e.direction+r)}function*u(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set or change direction of a non-sprite");const r=Number(t)||0;return yield*l(e,e.direction-r)}function*d(e,t,r){return c(e,t,r),null}function*h(e,t,r){return c(e,0-(Number(t)||0),r),null}function*_(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot move up non-sprite by "+Number(t)+" steps");let n=r??e.direction;n=Number(n)||0;const s=Number(t)||0,o=e.direction;return e.setDirection(n-90),c(e,0-s),e.setDirection(o),null}function*f(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot move down non-sprite by "+Number(t)+" steps");let n=r??e.direction;n=Number(n)||0;const s=Number(t)||0,o=e.direction;return e.setDirection(n-90),c(e,s),e.setDirection(o),null}function*y(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get x position of non-sprite");return e.x}function*T(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get y position of non-sprite");return e.y}function*E(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get direction of non-sprite");return e.direction}function*N(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot make a non-sprite say something");const r=String(t);return Scratch.vm.runtime.emit("SAY",e,"say",r),null}function*g(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot make a non-sprite think something");const r=String(t);return Scratch.vm.runtime.emit("SAY",e,"think",r),null}function*m(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set size of non-sprite");const r=Math.max(Number(t)||0,0);return e.setSize(r),null}function*b(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set visibility of non-sprite");const r=!1===(t??!1);return e.setVisible(r),null}function*v(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get size of non-sprite");return e.size}function*w(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get visibility of non-sprite");return e.visible}function*k(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x stretch of non-sprite to "+Number(t));const r=Number(t)||0;return e.setStretch(r,e.stretch[1]),null}function*x(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set y stretch of non-sprite to "+Number(t));const r=Number(t)||0;return e.setStretch(e.stretch[0],r),null}function*S(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x and y stretch of non-sprite to "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setStretch(n,s),null}function*O(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x stretch of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.stretch[0]+r,e.stretch[1]),null}function*R(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change y stretch of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.stretch[0],e.stretch[1]+r),null}function*A(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x and y stretch of non-sprite by "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setXY(e.stretch[0]+n,e.stretch[1]+s),null}function*C(e,t){if("string"!=typeof t&&"number"!=typeof t)throw new TypeError("Expected costume index to be a string or number");if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");const r=t;if("number"==typeof r)e.setCostume(r-1);else{const t=e.getCostumeIndexByName(r.toString());-1!==t?e.setCostume(t):isNaN(Number(r))||Scratch.Cast.isWhiteSpace(r)||e.setCostume(Number(r)-1)}return null}function*P(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume+1),null}function*L(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume-1),null}function*I(e){const t=Scratch.vm.runtime.getTargetForStage();if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("Expected costume index to be a string or number");if(!(t instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");const r=e;if("number"==typeof r)t.setCostume(r-1);else{const e=t.getCostumeIndexByName(r.toString());-1!==e?t.setCostume(e):isNaN(Number(r))||Scratch.Cast.isWhiteSpace(r)||t.setCostume(Number(r)-1)}return null}function*G(){const e=Scratch.vm.runtime.getTargetForStage();if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume+1),null}function*U(){const e=Scratch.vm.runtime.getTargetForStage();if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume-1),null}jsGen_1._globalEnv.__env.set("setCostume",{get value(){return C}}),jsGen_1._globalEnv.__env.set("nextCostume",{get value(){return P}}),jsGen_1._globalEnv.__env.set("previousCostume",{get value(){return L}}),jsGen_1._globalEnv.__env.set("setBackdrop",{get value(){return I}}),jsGen_1._globalEnv.__env.set("nextBackdrop",{get value(){return G}}),jsGen_1._globalEnv.__env.set("previousBackdrop",{get value(){return U}}),jsGen_1._globalEnv.__env.set("say",{get value(){return N}}),jsGen_1._globalEnv.__env.set("think",{get value(){return g}}),jsGen_1._globalEnv.__env.set("setSize",{get value(){return m}}),jsGen_1._globalEnv.__env.set("setVisible",{get value(){return b}}),jsGen_1._globalEnv.__env.set("getSize",{get value(){return v}}),jsGen_1._globalEnv.__env.set("getVisible",{get value(){return w}}),jsGen_1._globalEnv.__env.set("setXStretch",{get value(){return k}}),jsGen_1._globalEnv.__env.set("setYStretch",{get value(){return x}}),jsGen_1._globalEnv.__env.set("setXYStretch",{get value(){return S}}),jsGen_1._globalEnv.__env.set("changeXStretch",{get value(){return O}}),jsGen_1._globalEnv.__env.set("changeYStretch",{get value(){return R}}),jsGen_1._globalEnv.__env.set("changeXYStretch",{get value(){return A}}),jsGen_1._globalEnv.__env.set("getSprite",{get value(){return e}}),jsGen_1._globalEnv.__env.set("getX",{get value(){return y}}),jsGen_1._globalEnv.__env.set("getY",{get value(){return T}}),jsGen_1._globalEnv.__env.set("getDirection",{get value(){return E}}),jsGen_1._globalEnv.__env.set("setX",{get value(){return t}}),jsGen_1._globalEnv.__env.set("setY",{get value(){return r}}),jsGen_1._globalEnv.__env.set("setXY",{get value(){return n}}),jsGen_1._globalEnv.__env.set("changeX",{get value(){return s}}),jsGen_1._globalEnv.__env.set("changeY",{get value(){return o}}),jsGen_1._globalEnv.__env.set("changeXY",{get value(){return i}}),jsGen_1._globalEnv.__env.set("moveSteps",{get value(){return d}}),jsGen_1._globalEnv.__env.set("moveBackSteps",{get value(){return h}}),jsGen_1._globalEnv.__env.set("moveUpSteps",{get value(){return _}}),jsGen_1._globalEnv.__env.set("moveDownSteps",{get value(){return f}}),jsGen_1._globalEnv.__env.set("setDirection",{get value(){return l}}),jsGen_1._globalEnv.__env.set("turnLeft",{get value(){return u}}),jsGen_1._globalEnv.__env.set("turnRight",{get value(){return p}});class B{_globalEnv=jsGen_1._globalEnv;constructor(){Scratch.vm.runtime.registerCompiledExtensionBlocks("vgspenguinscript",this.getCompiledInfo())}getCompiledInfo(){return{ir:{evalStack:(e,t)=>(e.script.yields=!0,{kind:"stack",code:e.descendInputOfBlock(t,"code")}),evalReporter:(e,t)=>(e.script.yields=!0,{kind:"input",code:e.descendInputOfBlock(t,"code")})},js:{evalStack:(e,t,r)=>{const n=t.descendInput(e.code);let s;try{s=preCompile(JSON.parse(n.asString()),t.warpTimer,t.isWarp),t.source+='"require waitPromise";',t.source+=s+";"}catch(e){t.source+='"require waitPromise";',t.source+=`(yield* runtime.ext_vgspenguinscript.transpile(${n.asString()}, ${t.warpTimer}, ${t.isWarp})(runtime.ext_vgspenguinscript._globalEnv, target));`}},evalReporter:(e,t,r)=>{const n=t.descendInput(e.code);let s;try{return s=preCompile(JSON.parse(n.asString()),t.warpTimer,t.isWarp),canNullish?new r.TypedInput(`("require waitPromise",(${s} ?? "null"))`):new r.TypedInput(`("require waitPromise",nullish((${s}),"null"))`,r.TYPE_UNKNOWN)}catch(e){return canNullish?new r.TypedInput(`("require waitPromise",(yield* runtime.ext_vgspenguinscript.transpile(${n.asString()}, ${t.warpTimer}, ${t.isWarp})(runtime.ext_vgspenguinscript._globalEnv, target))  ?? "null")`,r.TYPE_UNKNOWN):new r.TypedInput(`("require waitPromise",nullish((yield* runtime.ext_vgspenguinscript.transpile(${n.asString()}, ${t.warpTimer}, ${t.isWarp})(runtime.ext_vgspenguinscript._globalEnv, target)),"null"))`,r.TYPE_UNKNOWN)}}}}}getInfo(){return{id:"vgspenguinscript",name:"PenguinScript",blocks:[{opcode:"evalStack",blockType:Scratch.BlockType.COMMAND,text:"evaluate [code]",func:"noComp",arguments:{code:{type:Scratch.ArgumentType.STRING,defaultValue:"let x = 5; x = 6 xor 5; global print<x>;"}}},{opcode:"evalReporter",allowDropAnywhere:!0,blockType:Scratch.BlockType.REPORTER,text:"evaluate [code]",func:"noComp",arguments:{code:{type:Scratch.ArgumentType.STRING,defaultValue:"return 69;"}}}]}}noComp(){throw"Please enable compiler."}transpile(e,t,r){return transpile(e,t,r)}getLexer(){return lexer_1.default}getParser(){return parser_1.default}getJSGenerator(){return jsGen_1.default}getGlobalEnv(){return jsGen_1._globalEnv}}Scratch.extensions.register(new B)}module.exports={Lexer:lexer_1.default,Parser:parser_1.default,JSGenerator:jsGen_1.default,transpile,default:transpile}},19:(e,t)=>{var r,n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.TokenToPrecedence=t.PrecendenceRules=t.Precedence=t.OutputType=t.NodeType=void 0,function(e){e[e.Program=0]="Program",e[e.VariableDeclaration=1]="VariableDeclaration",e[e.AssignmentExpr=2]="AssignmentExpr",e[e.Identifier=3]="Identifier",e[e.PrimitiveLiteral=4]="PrimitiveLiteral",e[e.BinaryExpr=5]="BinaryExpr",e[e.UnaryExpr=6]="UnaryExpr",e[e.StmtBlock=7]="StmtBlock",e[e.IfStatement=8]="IfStatement",e[e.NoOp=9]="NoOp",e[e.ElseStatement=10]="ElseStatement",e[e.While=11]="While",e[e.Function=12]="Function",e[e.Inline=13]="Inline",e[e.ReturnStatement=14]="ReturnStatement",e[e.ArgsList=15]="ArgsList",e[e.FunctionCall=16]="FunctionCall",e[e.Global=17]="Global",e[e.Target=18]="Target"}(r||(t.NodeType=r={})),function(e){e[e.String=0]="String",e[e.Number=1]="Number",e[e.Boolean=2]="Boolean",e[e.Object=3]="Object",e[e.List=4]="List",e[e.VariableReference=5]="VariableReference",e[e.Userdata=6]="Userdata"}(n||(t.OutputType=n={})),function(e){e[e.ASSIGNMENT=0]="ASSIGNMENT",e[e.NOT=1]="NOT",e[e.AND=2]="AND",e[e.XOR=3]="XOR",e[e.OR=4]="OR",e[e.ADDITIVE=5]="ADDITIVE",e[e.MULTIPLICATIVE=6]="MULTIPLICATIVE",e[e.EXPONENTIAL=7]="EXPONENTIAL",e[e.PRIMARY_EXPR=8]="PRIMARY_EXPR"}(s||(t.Precedence=s={})),t.PrecendenceRules={},t.TokenToPrecedence=function(e){return s.ASSIGNMENT}},345:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Token=t.TokenType=void 0,function(e){e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TRUE=2]="TRUE",e[e.FALSE=3]="FALSE",e[e.NULL=4]="NULL",e[e.IDENTIFIER=5]="IDENTIFIER",e[e.LET=6]="LET",e[e.CONST=7]="CONST",e[e.IF=8]="IF",e[e.ELSE=9]="ELSE",e[e.WHILE=10]="WHILE",e[e.FUNCTION=11]="FUNCTION",e[e.RETURN=12]="RETURN",e[e.INLINE=13]="INLINE",e[e.GLOBAL=14]="GLOBAL",e[e.TARGET=15]="TARGET",e[e.EQUALS=16]="EQUALS",e[e.BINARY_OPERATOR=17]="BINARY_OPERATOR",e[e.UNARY_OPERATOR=18]="UNARY_OPERATOR",e[e.SEMICOLON=19]="SEMICOLON",e[e.COMMA=20]="COMMA",e[e.OPEN_PAREN=21]="OPEN_PAREN",e[e.CLOSE_PAREN=22]="CLOSE_PAREN",e[e.OPEN_BRACE=23]="OPEN_BRACE",e[e.CLOSE_BRACE=24]="CLOSE_BRACE",e[e.OPEN_BRACKET=25]="OPEN_BRACKET",e[e.CLOSE_BRACKET=26]="CLOSE_BRACKET",e[e.OPEN_ANGLE=27]="OPEN_ANGLE",e[e.CLOSE_ANGLE=28]="CLOSE_ANGLE",e[e.EOF=29]="EOF"}(r||(t.TokenType=r={}));class n{type;raw;constructor(e=r.EOF,t=""){this.type=e,this.raw=t}}t.Token=n,t.default=class{Token=n;TokenType=r;Keywords={let:r.LET,const:r.CONST,and:r.BINARY_OPERATOR,or:r.BINARY_OPERATOR,xor:r.BINARY_OPERATOR,not:r.UNARY_OPERATOR,if:r.IF,else:r.ELSE,false:r.FALSE,true:r.TRUE,null:r.NULL,while:r.WHILE,repeatUntil:r.WHILE,forever:r.WHILE,fn:r.FUNCTION,return:r.RETURN,inline:r.INLINE,global:r.GLOBAL,target:r.TARGET};constructor(e){this.src=e,this.srcArr=e.split(""),this.tokens=[]}*yieldToken(e){this.tokens.push(e),yield e}*tokenize(){const e=this.srcArr;for(;e.length>0;)switch(e[0]){case" ":case"\n":case"\r":e.shift();break;case"<":{const t=new n(r.OPEN_ANGLE,e.shift());yield*this.yieldToken(t);break}case">":{const t=new n(r.CLOSE_ANGLE,e.shift());yield*this.yieldToken(t);break}case"(":{const t=new n(r.OPEN_PAREN,e.shift());this.tokens.push(t),yield t;break}case")":{const t=new n(r.CLOSE_PAREN,e.shift());this.tokens.push(t),yield t;break}case"{":{const t=new n(r.OPEN_BRACE,e.shift());this.tokens.push(t),yield t;break}case"}":{const t=new n(r.CLOSE_BRACE,e.shift());this.tokens.push(t),yield t;break}case"[":{const t=new n(r.OPEN_BRACKET,e.shift());this.tokens.push(t),yield t;break}case"]":{const t=new n(r.CLOSE_BRACKET,e.shift());this.tokens.push(t),yield t;break}case"+":case"-":case"*":case"/":case"%":case"^":{const t=new n(r.BINARY_OPERATOR,e.shift());yield*this.yieldToken(t);break}case"=":{const t=new n(r.EQUALS,e.shift());yield*this.yieldToken(t);break}case";":{const t=new n(r.SEMICOLON,e.shift());yield*this.yieldToken(t);break}case",":{const t=new n(r.COMMA,e.shift());yield*this.yieldToken(t);break}default:if(/^[_a-zA-Z]$/.test(e[0])){let t="";for(;"string"==typeof e[0]&&/^[_a-zA-Z]+[_a-zA-Z0-9]*$/.test(t+e[0])&&e.length>0;t+=e.shift());let s=this.Keywords[t];s?yield*this.yieldToken(new n(s,t)):yield*this.yieldToken(new n(r.IDENTIFIER,t))}else if('"'===e[0]){e.shift();let t="";for(;"string"==typeof e[0]&&'"'!==e[0]&&e.length>0;){const r=e.shift();if("\\"===r){const r=e.shift();switch(r){case"n":t+="\n";break;case"f":t+="\f";break;case"r":t+="\r";break;case"t":t+="\t";break;case"v":t+="\v";break;case"b":t+="\b";break;case"c":{const r=e.shift();if(!r||!/^[a-zA-Z]$/.test(r))throw new SyntaxError(`Expected letter after escape sequence \\c, got ${r||"<EOF>"} instead`);t+=String.fromCodePoint(r.codePointAt(0)||0);break}case"x":{let r,n;if(!/^[0-9a-fA-F]+$/.test((r=e[0])+(n=e[1])))throw new SyntaxError(`Expected two hexadecimal digits after escape sequence \\x, got ${r||"<EOF>"}${r?n||" and <EOF>":""} instead`);t+=String.fromCodePoint(Number("0x"+e.shift()+e.shift()));break}case"u":if(!/^[0-9a-fA-F]+$/.test(e.slice(0,4).join("")))throw new SyntaxError("Invalid Unicode escape sequence, expected 4 hexadecimal digits. ");t+=String.fromCodePoint(Number("0x"+e.shift()+e.shift()+e.shift()+e.shift()));break;case"U":if(!/^[0-9a-fA-F]+$/.test(e.slice(0,6).join("")))throw new SyntaxError("Invalid Unicode escape sequence, expected 6 hexadecimal digits. ");t+=String.fromCodePoint(Number("0x"+e.shift()+e.shift()+e.shift()+e.shift()+e.shift()+e.shift()));break;case"s":t+="💀";break;case"m":t+="🗿";break;case"z":t+="🥶";break;case"l":case"T":t+="🐢";break;case"F":t+="🔥";break;case"S":case"a":t+="✨";break;case"p":t+="🐧";break;case"0":t+="\0";break;default:t+=r||""}}else t+=r}if('"'!==e.shift())throw new SyntaxError("Expected closing quotes, got <EOF> instead.");yield*this.yieldToken(new n(r.STRING,t))}else{let t="";for(;"string"==typeof e[0]&&/^[0-9]+$/.test(t+e[0])&&e.length>0;t+=e.shift());if("."===e[0]&&/^[0-9]$/.test(String(e[1])))for(t+=e.shift(),t+=e.shift();"string"==typeof e[0]&&/^[0-9]+\.[0-9]+$/.test(t+e[0])&&e.length>0;t+=e.shift());yield*this.yieldToken(new n(r.NUMBER,t))}}yield*this.yieldToken(new n)}tokenizeNonGen(){this.tokens=[];const e=[];try{for(const t of this.tokenize())e.push(t)}catch(t){return{error:t,tokens:e}}return{error:null,tokens:e}}src;srcArr;tokens}},56:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(19),s=r(345);t.default=class{constructor(e){if(Array.isArray(e))this.tokens=e;else{const t=new s.default(e).tokenizeNonGen();if(t.error)throw t.error;this.tokens=t.tokens}}tokens=[];not_eof(){return this.tokens[0]?.type!==s.TokenType.EOF}at(){return this.tokens[0]}eat(){return this.tokens.shift()}expect(e){const t=this.eat();if(!t||t.type!==e)throw new SyntaxError(`Expected ${s.TokenType[e]} token, got ${s.TokenType[t?.type]} instead`);return t}produceAST(){const e={kind:n.NodeType.Program,body:[]};for(;this.not_eof();)e.body.push(this.parse_stmt());return e}parse_stmt(){switch(this.at().type){case s.TokenType.LET:case s.TokenType.CONST:return this.parse_variable_declaration();case s.TokenType.OPEN_BRACE:{this.eat();const e=[];for(;this.at().type!==s.TokenType.CLOSE_BRACE&&this.not_eof();){const t=this.parse_stmt();e.push(t)}return this.expect(s.TokenType.CLOSE_BRACE),this.at().type===s.TokenType.SEMICOLON&&this.eat(),{kind:n.NodeType.StmtBlock,body:e}}case s.TokenType.IF:return this.parse_if();case s.TokenType.WHILE:return this.parse_loop();case s.TokenType.INLINE:return this.parse_inline();case s.TokenType.ELSE:throw new SyntaxError("Unexpected else statement.");case s.TokenType.SEMICOLON:return this.eat(),{kind:n.NodeType.NoOp};case s.TokenType.RETURN:return this.parse_return();default:{const e=this.parse_expr();return this.expect(s.TokenType.SEMICOLON),e}}}parse_return(){this.eat();const e=this.parse_expr();return this.at().type===s.TokenType.RETURN&&this.eat(),{kind:n.NodeType.ReturnStatement,value:e}}parse_function(){this.eat();const e=this.parse_argslist();this.expect(s.TokenType.OPEN_BRACE);const t=[];for(;this.at().type!==s.TokenType.CLOSE_BRACE&&this.not_eof();){const e=this.parse_stmt();t.push(e)}this.expect(s.TokenType.CLOSE_BRACE);const r={kind:n.NodeType.StmtBlock,body:t};return{kind:n.NodeType.Function,args:e,body:r}}parse_argslist(){this.expect(s.TokenType.OPEN_ANGLE);const e=[];for(;this.at().type!==s.TokenType.CLOSE_ANGLE&&this.not_eof();){let t=this.parse_primary_expr();if(t.kind!==n.NodeType.Identifier)throw new SyntaxError("Expected parameter name.");this.not_eof()||this.tokens[1].type===s.TokenType.CLOSE_ANGLE?this.at().type===s.TokenType.COMMA&&this.eat():this.expect(s.TokenType.COMMA),e.forEach((e=>{if(e.symbol===t.symbol)throw new SyntaxError("Duplicate parameter name")})),e.push(t)}return this.expect(s.TokenType.CLOSE_ANGLE),{kind:n.NodeType.ArgsList,args:e}}parse_inline(){return this.eat(),{kind:n.NodeType.Inline,body:this.parse_stmt()}}parse_loop(){switch(this.eat().raw){case"while":return{kind:n.NodeType.While,condition:this.parse_expr(),body:this.parse_stmt()};case"repeatUntil":return{kind:n.NodeType.While,condition:{kind:n.NodeType.UnaryExpr,operand:this.parse_expr(),operator:"not"},body:this.parse_stmt()};case"forever":return{kind:n.NodeType.While,condition:{kind:n.NodeType.PrimitiveLiteral,value:!0},body:this.parse_stmt()}}}parse_if(){this.eat();const e=this.parse_expr(),t=this.parse_stmt();let r;if(this.at().type===s.TokenType.ELSE){this.eat();const s=this.parse_stmt();return r={kind:n.NodeType.ElseStatement,body:s},{kind:n.NodeType.IfStatement,body:t,condition:e,else:r}}return{kind:n.NodeType.IfStatement,body:t,condition:e}}parse_variable_declaration(){const e=this.eat().type===s.TokenType.CONST,t=this.expect(s.TokenType.IDENTIFIER).raw;if(this.at().type===s.TokenType.SEMICOLON){if(this.eat(),e)throw new SyntaxError("Must declare constant with initializer");return{kind:n.NodeType.VariableDeclaration,constant:!1,symbol:t}}this.expect(s.TokenType.EQUALS);const r={kind:n.NodeType.VariableDeclaration,constant:e,symbol:t,value:this.parse_expr()};return this.expect(s.TokenType.SEMICOLON),r}parse_expr(){return this.parse_assignment_expr()}parse_not_expr(){if("not"===this.at().raw){this.eat();const e=this.parse_not_expr();return{kind:n.NodeType.UnaryExpr,operand:e,operator:"not"}}return this.parse_additive_expr()}parse_and_expr(){let e=this.parse_xor_expr();for(;"and"===this.at().raw;){const t=this.eat().raw,r=this.parse_xor_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_xor_expr(){let e=this.parse_or_expr();for(;"xor"===this.at().raw;){const t=this.eat().raw,r=this.parse_or_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_or_expr(){let e=this.parse_not_expr();for(;"or"===this.at().raw;){const t=this.eat().raw,r=this.parse_not_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_assignment_expr(){const e=this.parse_and_expr();if(this.at().type===s.TokenType.EQUALS){this.eat();const t=this.parse_assignment_expr();return{kind:n.NodeType.AssignmentExpr,value:t,assigne:e}}return e}parse_additive_expr(){let e=this.parse_multiplicative_expr();for(;"+"===this.at().raw||"-"===this.at().raw;){const t=this.eat().raw,r=this.parse_multiplicative_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_multiplicative_expr(){let e=this.parse_exponential_expr();for(;"*"===this.at().raw||"/"===this.at().raw||"%"===this.at().raw;){const t=this.eat().raw,r=this.parse_exponential_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_exponential_expr(){let e=this.parse_function_call();for(;"^"===this.at().raw;){const t=this.eat().raw,r=this.parse_function_call();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_function_call(){const e=this.parse_primary_expr();if(this.at().type===s.TokenType.OPEN_ANGLE){this.expect(s.TokenType.OPEN_ANGLE);const t=[];for(;this.at().type!==s.TokenType.CLOSE_ANGLE&&this.not_eof();){const e=this.parse_expr();this.not_eof()||this.tokens[1].type===s.TokenType.CLOSE_ANGLE?this.at().type===s.TokenType.COMMA&&this.eat():this.expect(s.TokenType.COMMA),t.push(e)}return this.expect(s.TokenType.CLOSE_ANGLE),{kind:n.NodeType.FunctionCall,func:e,args:t}}return e}parse_primary_expr(){const e=this.at().type;switch(e){case s.TokenType.IDENTIFIER:return{kind:n.NodeType.Identifier,symbol:this.eat().raw};case s.TokenType.GLOBAL:if(this.eat(),this.at().type!==s.TokenType.IDENTIFIER)throw new SyntaxError("Expected identifier after keyword global");return{kind:n.NodeType.Global,symbol:this.eat().raw};case s.TokenType.TARGET:return this.eat(),{kind:n.NodeType.Target};case s.TokenType.NUMBER:return{kind:n.NodeType.PrimitiveLiteral,value:Number(this.eat().raw)};case s.TokenType.STRING:return{kind:n.NodeType.PrimitiveLiteral,value:this.eat().raw};case s.TokenType.TRUE:return this.eat(),{kind:n.NodeType.PrimitiveLiteral,value:!0};case s.TokenType.FALSE:return this.eat(),{kind:n.NodeType.PrimitiveLiteral,value:!1};case s.TokenType.NULL:return this.eat(),{kind:n.NodeType.PrimitiveLiteral,value:null};case s.TokenType.OPEN_PAREN:{this.eat();const e=this.parse_expr();return this.expect(s.TokenType.CLOSE_PAREN),e}case s.TokenType.FUNCTION:return this.parse_function();default:throw new SyntaxError(`Invalid or unexpected token ${s.TokenType[e]}.`)}}}},134:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._globalEnv=t.VariablePool=t.OutputType=void 0;const n=r(19);var s;!function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_STRING=1]="TYPE_STRING",e[e.TYPE_BOOLEAN=2]="TYPE_BOOLEAN",e[e.TYPE_UNKNOWN=3]="TYPE_UNKNOWN"}(s||(t.OutputType=s={}));class o{src;type;isAlwaysNumber(){return this.type===s.TYPE_NUMBER}isAlwaysString(){return this.type===s.TYPE_STRING}asNumber(){return this.isAlwaysNumber()?this.src:`Number(${this.src})`}asString(){return this.isAlwaysString()?this.src:`String(${this.src})`}asBoolean(){return`((${this.src} ?? false) === false)`}asUnknown(){return`(${this.src} ?? null)`}asIdent(){return`(${this.src})`}constructor(e,t){this.src=e,this.type=t}}class i{constantValue;constructor(e){this.constantValue=e}isAlwaysNumber(){return"number"==typeof this.constantValue}isAlwaysString(){return"string"==typeof this.constantValue}asNumber(){return this.isAlwaysNumber()?this.constantValue.toString():Number(this.constantValue).toString()}asString(){return this.isAlwaysString()?JSON.stringify(this.constantValue):JSON.stringify(this.constantValue.toString())}asBoolean(){return"boolean"==typeof this.constantValue?this.constantValue.toString():(!1===(this.constantValue??!1)).toString()}asUnknown(){switch(typeof this.constantValue){case"number":return this.asNumber();case"boolean":return this.asBoolean();case"object":if(this.constantValue)throw new Error("Unexpected Object.");return"null";default:return this.asString()}}asIdent(){return"(null)"}}function*a(e){let t=0;for(;;)yield e+t++}t.VariablePool=a;const c=a("s");t._globalEnv={__env:new Map,__readonly:new Map,makeReadOnly:function(e){return this.__readonly.set(e,!0)},readOnly:function(e){return this.__readonly.get(e)},set:function(e,t){if(this.__readonly.get(e))throw new TypeError("Attempted to overwrite read-only global");return this.__env.set(e,t),t},remove:function(e){if(this.__readonly.get(e))throw new TypeError("Attempted to remove read-only global");return this.__env.delete(e)},get:function(e){return this.__env.get(e)??(this.__env.set(e,{value:null}),this.__env.get(e))}};const l=function*(){}.constructor;t.default=class{program;src="let _;let _2;let _3;let _4;";scriptName;_variablePool;_cachedVariables;_globalEnv;warpTimer;isWarp;yields;constructor(e){this.program=e,this.scriptName=c.next().value,this._variablePool=a("v"),this._cachedVariables={__proto__:null},this._globalEnv=t._globalEnv}transpile(e,t,r,n){const s=this.program;this.warpTimer=r,this.isWarp=n,this.yields=t;for(const e of s.body)this.descendNode(e);switch(e){case"string":return this.src;case"func":return new Function("$globalEnv","$target",this.src);case"generator":return new l("$globalEnv","$target",this.src)}}yielded(){if(!this.yields)throw new Error("Script yielded but is not marked as yielding")}yieldLoop(){this.warpTimer?(this.isWarp?this.src+="if (isStuck()) yield;":this.src+="yield;",this.yielded()):this.isWarp||(this.src+="yield;",this.yielded())}getVariable(e){if(this._cachedVariables[e])return this._cachedVariables[e];const t=this._variablePool.next().value;return this._cachedVariables[e]=t}descendNode(e){switch(e.kind){case n.NodeType.NoOp:break;case n.NodeType.StmtBlock:{const t=e;this.src+="{";for(const e of t.body)this.descendNode(e);this.src+="}";break}case n.NodeType.ReturnStatement:{const t=e;this.src+="return(",this.src+=this.descendExpr(t.value).asUnknown(),this.src+=")",this.src+="?? null;";break}case n.NodeType.IfStatement:{const t=e;if(this.src+="if(",this.src+=this.descendExpr(t.condition).asBoolean(),this.src+=")",t.body.kind===n.NodeType.VariableDeclaration)throw new SyntaxError("Cannot declare a variable in a single-statement context");if(this.descendNode(t.body),t.else){if(this.src+="else ",t.else.body.kind===n.NodeType.VariableDeclaration)throw new SyntaxError("Cannot declare a variable in a single-statement context");this.descendNode(t.else.body)}this.src+=";";break}case n.NodeType.VariableDeclaration:{const t=e,r=this.getVariable(t.symbol);if(t.constant?this.src+="const ":this.src+="let ",this.src+=r,t.value){const e=this.descendExpr(t.value);this.src+="=",this.src+=e.asUnknown()}this.src+=";";break}case n.NodeType.While:{const t=e;if(this.src+="while(",this.src+=this.descendExpr(t.condition).asBoolean(),this.src+="){",t.body.kind===n.NodeType.VariableDeclaration)throw new SyntaxError("Cannot declare a variable in a single-statement context");this.descendNode(t.body),this.yieldLoop(),this.src}default:{const t=this.descendExpr(e);this.src+=t.asUnknown(),this.src+=";"}}}descendExpr(e){switch(e.kind){case n.NodeType.Global:{const t=e;return new o(`($globalEnv.get(${JSON.stringify(t.symbol)}).value)`,s.TYPE_UNKNOWN)}case n.NodeType.AssignmentExpr:{const t=e;if(t.assigne.kind!==n.NodeType.Identifier&&t.assigne.kind!==n.NodeType.Global)throw new SyntaxError("Invalid left-hand in assignment");const r=this.descendExpr(t.assigne),i=this.descendExpr(t.value);return new o(`((${r.asIdent()}) = (${i.asUnknown()}))`,s.TYPE_UNKNOWN)}case n.NodeType.UnaryExpr:{const t=e,r=this.descendExpr(t.operand);if("not"===t.operator)return new o(`(!(${r.asBoolean()}))`,s.TYPE_BOOLEAN);throw new SyntaxError("Unknown unary operator")}case n.NodeType.BinaryExpr:{const t=e;switch(t.operator){case"and":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(_ = ${e.asUnknown()}, _2 = ${r.asUnknown()}, (((_ ?? false) === false) && !((_2 ?? false) === false)) ? _ : (((_2 ?? false) === false) && !((_ ?? false) === false)) ? _2 : _)`,s.TYPE_UNKNOWN)}case"xor":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(_ = ${e.asUnknown()}, _2 = ${r.asUnknown()}, (((_ ?? false) === false) && !((_2 ?? false) === false)) ? _2 : (((_2 ?? false) === false) && !((_ ?? false) === false)) ? _ : false)`,s.TYPE_UNKNOWN)}case"or":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(_ = ${e.asUnknown()}, _2 = ${r.asUnknown()}, (((_ ?? false) === false) && !((_2 ?? false) === false)) ? _ : _2)`,s.TYPE_UNKNOWN)}case"+":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} + ${r.asNumber()})`,s.TYPE_NUMBER)}case"-":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} - ${r.asNumber()})`,s.TYPE_NUMBER)}case"*":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} * ${r.asNumber()})`,s.TYPE_NUMBER)}case"/":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} / ${r.asNumber()})`,s.TYPE_NUMBER)}case"%":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} % ${r.asNumber()})`,s.TYPE_NUMBER)}case"^":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} ** ${r.asNumber()})`,s.TYPE_NUMBER)}}}case n.NodeType.PrimitiveLiteral:{const t=e.value;return new i(t)}case n.NodeType.Identifier:{const t=e,r=this.getVariable(t.symbol);return new o(`(${r})`,s.TYPE_UNKNOWN)}case n.NodeType.Inline:{const t=e;let r="";const n=this.src;this.src="",this.descendNode(t.body);const i=this.src;return this.src=n,this.yields?r+="(yield*(function*(){":r+="(function(){",r+=i,r+="})()",this.yields&&(r+=")"),new o(`(${r})`,s.TYPE_UNKNOWN)}case n.NodeType.Function:{const t=e,r=t.args.args,n=this.src;this.src="",this.descendNode(t.body);const i=this.src;this.src=n;let a="";for(const e of r)a+=this.getVariable(e.symbol),a+=",";return new o(`(function*(${a}){${i}})`,s.TYPE_UNKNOWN)}case n.NodeType.FunctionCall:{const t=e,r=this.descendExpr(t.func).asUnknown(),n=[];for(const e of t.args)n.push(this.descendExpr(e).asUnknown());return new o(`((yield* ${r}(${n.join(",")})) ?? null)`,s.TYPE_UNKNOWN)}case n.NodeType.Target:return new o("($target)",s.TYPE_UNKNOWN)}}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}var __webpack_exports__=__webpack_require__(156);return __webpack_exports__})()));
