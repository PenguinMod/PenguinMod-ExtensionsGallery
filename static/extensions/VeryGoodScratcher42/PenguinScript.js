// Bundled with webpack, repo at https://github.com/lego7set/PenguinScript.
// Version 1.0.1.2
// Expect this thingy to have a lot of bugs.
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(()=>(()=>{"use strict";var __webpack_modules__={156:(module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});const parser_1=__webpack_require__(56),lexer_1=__webpack_require__(345),jsGen_1=__webpack_require__(134);function transpile(e,t,r){const n=new parser_1.default(e).produceAST();return new jsGen_1.default(n).transpile("generator",!0,t,r)}function preCompile(e,t,r){const n=new parser_1.default(e).produceAST();return"(yield* (function*($globalEnv, $target, isStuck){"+new jsGen_1.default(n).transpile("string",!0,t,r)+"})(runtime.ext_vgspenguinscript._globalEnv, target, isStuck))"}function*createObjectStruct(){const e={__proto__:null,isStruct:!0,props:{__proto__:null},isObject:!0},t={__proto__:null};return e.props.get=function*(e){return t[e]},e.props.set={value:function*(e,r){return t[e]=r}},e.props.has={value:function*(e){return e in t}},e.props.delete={value:function*(e){return delete t[e]}},e.props.remove={value:function*(r){return delete t[r],e}},e.props.append={value:function*(r,n){return t[r]=n,e}},e}function*createArrayStruct(){const e={__proto__:null,isStruct:!0,props:{__proto__:null},isArray:!0},t=[];return e.props.get=function*(e){if("number"!=typeof e)throw new TypeError("Key to array must be a number.");return t[e]},e.props.set={value:function*(e,r){if("number"!=typeof e)throw new TypeError("Key to array must be a number.");return t[e]=r}},e.props.has={value:function*(e){if("number"!=typeof e)throw new TypeError("Key to array must be a number.");return e in t}},e.props.delete={value:function*(e){if("number"!=typeof e)throw new TypeError("Key to array must be a number.");return delete t[e]}},e.props.pop={value:function*(){return t.pop()}},e.props.push={value:function*(r){return t.push(r),e}},e.props.shift={value:function*(){return t.shift()}},e.props.unshift={value:function*(r){return t.unshift(r),e}},e.props.length={get value(){return t.length},set value(e){t.length=e}},e}function*log(...e){return console.log(...e),null}function*warn(...e){return console.warn(...e),null}function*error(...e){return console.error(...e),null}function*convertToString(e){return String(e)}function*convertToNumber(e){return Number(e)}function*convertToBoolean(e){return Boolean(e)}function*charFromCodePoint(e){return String.fromCodePoint(Number(e)||0)}function*charToCodePoint(e){if("string"!=typeof e)throw new TypeError("Please pass in a string to charToCodePoint");return e.codePointAt(0)??null}function*type(e){return typeof e}function*exit(e){throw{isExit:!0,returnValue:e}}function*getMathForPS(e){if("string"!=typeof e)throw new TypeError("Expected math item to a string");if(!Object.hasOwn(Math,e))throw new TypeError("Invalid math item");const t=Math[e];return"function"==typeof t?function*(...e){return t(...e)}:Math[e]}function*join(e,t){return String(e)+String(t)}function*createMethod(e,t){if(!e.isStruct)throw new TypeError;return function*(...r){return yield*t(e,...r)}}function supportsNullishCoalescing(){try{return eval("true ?? 0")}catch(e){return!1}}jsGen_1._globalEnv.__env.set("Object",{get value(){return createObjectStruct}}),jsGen_1._globalEnv.__env.set("Array",{get value(){return createArrayStruct}}),jsGen_1._globalEnv.__env.set("print",{get value(){return log}}),jsGen_1._globalEnv.__env.set("warn",{get value(){return warn}}),jsGen_1._globalEnv.__env.set("error",{get value(){return error}}),jsGen_1._globalEnv.__env.set("toString",{get value(){return convertToString}}),jsGen_1._globalEnv.__env.set("toNumber",{get value(){return convertToNumber}}),jsGen_1._globalEnv.__env.set("toBoolean",{get value(){return convertToBoolean}}),jsGen_1._globalEnv.__env.set("charFromCodePoint",{get value(){return charFromCodePoint}}),jsGen_1._globalEnv.__env.set("charToCodePoint",{get value(){return charToCodePoint}}),jsGen_1._globalEnv.__env.set("typeof",{get value(){return type}}),jsGen_1._globalEnv.__env.set("exit",{get value(){return exit}}),jsGen_1._globalEnv.__env.set("getMath",{get value(){return getMathForPS}}),jsGen_1._globalEnv.__env.set("join",{get value(){return join}}),jsGen_1._globalEnv.__env.set("concat",{get value(){return join}}),jsGen_1._globalEnv.__env.set("createMethod",{get value(){return createMethod}});const canNullish=supportsNullishCoalescing();let Scratch;if("object"==typeof window&&window&&"object"==typeof window.document&&"object"==typeof(Scratch=window.Scratch)&&Scratch){if(!Scratch.extensions.isPenguinMod)throw"Please load PenguinScript in PenguinMod";function*e(e){if("string"!=typeof e)throw new TypeError("Attempted to get sprite with name, but name is not a string");return Scratch.vm.runtime.getSpriteTargetByName(e)}function*t(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x position of non-sprite to "+Number(t));const r=Number(t)||0;return e.setXY(r,e.y,!1),null}function*r(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set y position of non-sprite to "+Number(t));const r=Number(t)||0;return e.setXY(e.x,r,!1),null}function*n(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x and y position of non-sprite to "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setXY(n,s,!1),null}function*s(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x position of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.x+r,e.y,!1),null}function*o(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change y position of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.x,e.y+r,!1),null}function*i(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x and y position of non-sprite by "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setXY(e.x+n,e.y+s,!1),null}function*a(e){return e*Math.PI/180}function c(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot move a non-sprite by "+Number(t)+" steps");Number(t);const n=r??e.direction,s=e.direction;e.setDirection(Number(n)||0);const o=e.direction;e.setDirection(s);const i=a(o).next().value,c=t*Math.cos(i),u=t*Math.sin(i);e.setXY(e.x+c,e.y+u)}function*u(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set or change direction of a non-sprite");const r=Number(t)||0;return e.setDirection(r),null}function*l(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set or change direction of a non-sprite");const r=Number(t)||0;return yield*u(e,e.direction+r)}function*p(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set or change direction of a non-sprite");const r=Number(t)||0;return yield*u(e,e.direction-r)}function*h(e,t,r){return c(e,t,r),null}function*d(e,t,r){return c(e,0-(Number(t)||0),r),null}function*_(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot move up non-sprite by "+Number(t)+" steps");let n=r??e.direction;n=Number(n)||0;const s=Number(t)||0,o=e.direction;return e.setDirection(n-90),c(e,0-s),e.setDirection(o),null}function*f(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot move down non-sprite by "+Number(t)+" steps");let n=r??e.direction;n=Number(n)||0;const s=Number(t)||0,o=e.direction;return e.setDirection(n-90),c(e,s),e.setDirection(o),null}function*T(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get x position of non-sprite");return e.x}function*g(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get y position of non-sprite");return e.y}function*y(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get direction of non-sprite");return e.direction}function*E(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot make a non-sprite say something");const r=String(t);return Scratch.vm.runtime.emit("SAY",e,"say",r),null}function*v(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot make a non-sprite think something");const r=String(t);return Scratch.vm.runtime.emit("SAY",e,"think",r),null}function*m(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set size of non-sprite");const r=Math.max(Number(t)||0,0);return e.setSize(r),null}function*N(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot set visibility of non-sprite");const r=!1===(t??!1);return e.setVisible(r),null}function*b(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get size of non-sprite");return e.size}function*w(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get visibility of non-sprite");return e.visible}function*S(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x stretch of non-sprite to "+Number(t));const r=Number(t)||0;return e.setStretch(r,e.stretch[1]),null}function*k(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set y stretch of non-sprite to "+Number(t));const r=Number(t)||0;return e.setStretch(e.stretch[0],r),null}function*x(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set x and y stretch of non-sprite to "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setStretch(n,s),null}function*R(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x stretch of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.stretch[0]+r,e.stretch[1]),null}function*O(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change y stretch of non-sprite by "+Number(t));const r=Number(t)||0;return e.setXY(e.stretch[0],e.stretch[1]+r),null}function*A(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to change x and y stretch of non-sprite by "+Number(t)+"and "+Number(r)+" respectively");const n=Number(t)||0,s=Number(r)||0;return e.setXY(e.stretch[0]+n,e.stretch[1]+s),null}function*C(e,t){if("string"!=typeof t&&"number"!=typeof t)throw new TypeError("Expected costume index to be a string or number");if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");const r=t;if("number"==typeof r)e.setCostume(r-1);else{const t=e.getCostumeIndexByName(r.toString());-1!==t?e.setCostume(t):isNaN(Number(r))||Scratch.Cast.isWhiteSpace(r)||e.setCostume(Number(r)-1)}return null}function*I(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume+1),null}function*P(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume-1),null}function*G(e){const t=Scratch.vm.runtime.getTargetForStage();if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("Expected costume index to be a string or number");if(!(t instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");const r=e;if("number"==typeof r)t.setCostume(r-1);else{const e=t.getCostumeIndexByName(r.toString());-1!==e?t.setCostume(e):isNaN(Number(r))||Scratch.Cast.isWhiteSpace(r)||t.setCostume(Number(r)-1)}return null}function*B(){const e=Scratch.vm.runtime.getTargetForStage();if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume+1),null}function*j(){const e=Scratch.vm.runtime.getTargetForStage();if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to set costume of a non-sprite");return e.setCostume(e.currentCostume-1),null}function*L(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to get current costume name of non-sprite");return e.getCostumes()[e.currentCostume].name}function*U(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to get current costume number of non-sprite");return e.currentCostume+1}function*$(){const e=Scratch.vm.runtime.getTargetForStage();if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to get current costume name of non-sprite");return e.getCostumes()[e.currentCostume].name}function*Y(){const e=Scratch.vm.runtime.getTargetForStage();if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Attempted to get current costume number of non-sprite");return e.currentCostume+1}function*D(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get x stretch of non-sprite");return e.stretch[0]}function*M(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get y stretch of non-sprite");return e.stretch[1]}function*V(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get variable for a non-sprite");return e.lookupVariableByNameAndType(t,"",!0)?.value??null}function*F(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get variable for a non-sprite");const n=e.lookupVariableByNameAndType(t,"",!0);return n?n.value=String(r):null}function*W(e){const t=Scratch.vm.runtime.getTargetForStage();if(!(t instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get variable for a non-sprite");return t.lookupVariableByNameAndType(e,"",!0)?.value??null}function*K(e,t){const r=Scratch.vm.runtime.getTargetForStage();if(!(r instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot get variable for a non-sprite");const n=r.lookupVariableByNameAndType(e,"",!0);return n?n.value=String(t):null}function*X(e){const t=String(e);return Scratch.vm.runtime.startHats("event_whenbroadcastreceived",{BROADCAST_OPTION:t}),null}function*z(e,t){if(!(t instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot broadcast to a non-sprite");const r=String(e);return Scratch.vm.runtime.startHats("event_whenbroadcastreceived",{BROADCAST_OPTION:r},t),null}function*H(e){return e instanceof Scratch.vm.exports.RenderedTarget}function*q(e,t){if(!(e instanceof Scratch.vm.exports.RenderedTarget&&t instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Both sprites for isTouchingSprite must be sprites");return!!Scratch.vm.renderer&&Scratch.vm.renderer.isTouchingDrawables(e.drawableID,[t.drawableID])}function*J(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot check if a non-sprite is touching the mouse");if(!Scratch.vm.renderer)return!1;const t=Scratch.vm.runtime.ioDevices.mouse;return!!t&&Scratch.vm.renderer.drawableTouching(e.drawableID,t.getClientX(),t.getClientY())}function*Q(e,t,r){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot check if a non-sprite is touching a point");return!!Scratch.vm.renderer&&Scratch.vm.renderer.drawableTouching(e.drawableID,Number(t)||0,Number(r)||0)}function*Z(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot check if a non-sprite is touching the edge");return e.isTouchingEdge()}function ee(){return!!Scratch.vm.runtime.ioDevices.mouse&&Scratch.vm.runtime.ioDevices.mouse.getIsDown()}function te(){return!!Scratch.vm.runtime.ioDevices.mouse&&Scratch.vm.runtime.ioDevices.mouse.getIsClicked()}function*re(e){return!!Scratch.vm.runtime.ioDevices.keyboard&&Scratch.vm.runtime.ioDevices.keyboard.getKeyIsDown(e)}function*ne(e){return!!Scratch.vm.runtime.ioDevices.keyboard&&Scratch.vm.runtime.ioDevices.keyboard.getKeyIsHit(e)}function*se(e){if(!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("Cannot create clone of a non-sprite");const t=e.makeClone();return t&&(Scratch.vm.runtime.addTarget(t),t.goBehindOther(e)),t}function*oe(e,t,r){let n=e;if("string"==typeof e&&(n=Scratch.vm.runtime.getSpriteTargetByName(e)),!(e instanceof Scratch.vm.exports.RenderedTarget))throw new TypeError("The sprite passed to getCloneWithVar is not a sprite name or sprite");const s=n.sprite.clones;for(let e=1;e<s.length;e++){const n=s[e].lookupVariableByNameAndType(t,"",!0);if(n&&0===Scratch.Cast.compare(n.value,r))return s[e]}return null}jsGen_1._globalEnv.__env.set("getCostumeName",{get value(){return L}}),jsGen_1._globalEnv.__env.set("getCostumeNumber",{get value(){return U}}),jsGen_1._globalEnv.__env.set("getBackdropName",{get value(){return $}}),jsGen_1._globalEnv.__env.set("getBackdropNumber",{get value(){return Y}}),jsGen_1._globalEnv.__env.set("setCostume",{get value(){return C}}),jsGen_1._globalEnv.__env.set("nextCostume",{get value(){return I}}),jsGen_1._globalEnv.__env.set("previousCostume",{get value(){return P}}),jsGen_1._globalEnv.__env.set("setBackdrop",{get value(){return G}}),jsGen_1._globalEnv.__env.set("nextBackdrop",{get value(){return B}}),jsGen_1._globalEnv.__env.set("previousBackdrop",{get value(){return j}}),jsGen_1._globalEnv.__env.set("say",{get value(){return E}}),jsGen_1._globalEnv.__env.set("think",{get value(){return v}}),jsGen_1._globalEnv.__env.set("setSize",{get value(){return m}}),jsGen_1._globalEnv.__env.set("setVisible",{get value(){return N}}),jsGen_1._globalEnv.__env.set("getSize",{get value(){return b}}),jsGen_1._globalEnv.__env.set("getVisible",{get value(){return w}}),jsGen_1._globalEnv.__env.set("setXStretch",{get value(){return S}}),jsGen_1._globalEnv.__env.set("setYStretch",{get value(){return k}}),jsGen_1._globalEnv.__env.set("setXYStretch",{get value(){return x}}),jsGen_1._globalEnv.__env.set("changeXStretch",{get value(){return R}}),jsGen_1._globalEnv.__env.set("changeYStretch",{get value(){return O}}),jsGen_1._globalEnv.__env.set("changeXYStretch",{get value(){return A}}),jsGen_1._globalEnv.__env.set("getXStretch",{get value(){return D}}),jsGen_1._globalEnv.__env.set("getYStretch",{get value(){return M}}),jsGen_1._globalEnv.__env.set("getSprite",{get value(){return e}}),jsGen_1._globalEnv.__env.set("getX",{get value(){return T}}),jsGen_1._globalEnv.__env.set("getY",{get value(){return g}}),jsGen_1._globalEnv.__env.set("getDirection",{get value(){return y}}),jsGen_1._globalEnv.__env.set("setX",{get value(){return t}}),jsGen_1._globalEnv.__env.set("setY",{get value(){return r}}),jsGen_1._globalEnv.__env.set("setXY",{get value(){return n}}),jsGen_1._globalEnv.__env.set("changeX",{get value(){return s}}),jsGen_1._globalEnv.__env.set("changeY",{get value(){return o}}),jsGen_1._globalEnv.__env.set("changeXY",{get value(){return i}}),jsGen_1._globalEnv.__env.set("moveSteps",{get value(){return h}}),jsGen_1._globalEnv.__env.set("moveBackSteps",{get value(){return d}}),jsGen_1._globalEnv.__env.set("moveUpSteps",{get value(){return _}}),jsGen_1._globalEnv.__env.set("moveDownSteps",{get value(){return f}}),jsGen_1._globalEnv.__env.set("setDirection",{get value(){return u}}),jsGen_1._globalEnv.__env.set("turnLeft",{get value(){return p}}),jsGen_1._globalEnv.__env.set("turnRight",{get value(){return l}}),jsGen_1._globalEnv.__env.set("degToRad",{get value(){return a}}),jsGen_1._globalEnv.__env.set("getVariableForSprite",{get value(){return V}}),jsGen_1._globalEnv.__env.set("setVariableForSprite",{get value(){return F}}),jsGen_1._globalEnv.__env.set("getVariableForAllSprites",{get value(){return W}}),jsGen_1._globalEnv.__env.set("setVariableForAllSprites",{get value(){return K}}),jsGen_1._globalEnv.__env.set("broadcast",{get value(){return X}}),jsGen_1._globalEnv.__env.set("broadcastToSprite",{get value(){return z}}),jsGen_1._globalEnv.__env.set("isSprite",{get value(){return H}}),jsGen_1._globalEnv.__env.set("isTouchingSprite",{get value(){return q}}),jsGen_1._globalEnv.__env.set("isTouchingMouse",{get value(){return J}}),jsGen_1._globalEnv.__env.set("isTouchingXY",{get value(){return Q}}),jsGen_1._globalEnv.__env.set("isTouchingEdge",{get value(){return Z}}),jsGen_1._globalEnv.__env.set("mouseDown",{get value(){return!!Scratch.vm.runtime.ioDevices.mouse&&Scratch.vm.runtime.ioDevices.mouse.getIsDown()}}),jsGen_1._globalEnv.__env.set("mouseClicked",{get value(){return!!Scratch.vm.runtime.ioDevices.mouse&&Scratch.vm.runtime.ioDevices.mouse.getIsClicked()}}),jsGen_1._globalEnv.__env.set("mouseX",{get value(){return Scratch.vm.runtime.ioDevices.mouse?Scratch.vm.runtime.ioevices.mouse.getScratchX():0}}),jsGen_1._globalEnv.__env.set("mouseY",{get value(){return Scratch.vm.runtime.ioDevices.mouse?Scratch.vm.runtime.ioevices.mouse.getScratchY():0}}),jsGen_1._globalEnv.__env.set("isKeyDown",{get value(){return re}}),jsGen_1._globalEnv.__env.set("isKeyHit",{get value(){return ne}}),jsGen_1._globalEnv.__env.set("createClone",{get value(){return se}}),jsGen_1._globalEnv.__env.set("getCloneWithVar",{get value(){return oe}});class ie{_globalEnv=jsGen_1._globalEnv;constructor(){Scratch.vm.runtime.registerCompiledExtensionBlocks("vgspenguinscript",this.getCompiledInfo())}getCompiledInfo(){return{ir:{evalStack:(e,t)=>(e.script.yields=!0,{kind:"stack",code:e.descendInputOfBlock(t,"code")}),evalReporter:(e,t)=>(e.script.yields=!0,{kind:"input",code:e.descendInputOfBlock(t,"code")})},js:{evalStack:(e,t,r)=>{const n=t.descendInput(e.code);let s;try{s=preCompile(JSON.parse(n.asString()),t.warpTimer,t.isWarp),t.source+=s+";"}catch(e){t.source+=`(yield* runtime.ext_vgspenguinscript.transpile(${n.asString()}, ${t.warpTimer}, ${t.isWarp})(runtime.ext_vgspenguinscript._globalEnv, target, isStuck));`}},evalReporter:(e,t,r)=>{const n=t.descendInput(e.code);let s;try{return s=preCompile(JSON.parse(n.asString()),t.warpTimer,t.isWarp),canNullish?new r.TypedInput(`(${s} ?? "null")`):new r.TypedInput(`nullish((${s}),"null")`,r.TYPE_UNKNOWN)}catch(e){return canNullish?new r.TypedInput(`((yield* runtime.ext_vgspenguinscript.transpile(${n.asString()}, ${t.warpTimer}, ${t.isWarp})(runtime.ext_vgspenguinscript._globalEnv, target, isStuck))  ?? "null)"`,r.TYPE_UNKNOWN):new r.TypedInput(`nullish((yield* runtime.ext_vgspenguinscript.transpile(${n.asString()}, ${t.warpTimer}, ${t.isWarp})(runtime.ext_vgspenguinscript._globalEnv, target, isStuck)),"null"))`,r.TYPE_UNKNOWN)}}}}}getInfo(){return{id:"vgspenguinscript",name:"PenguinScript",docsURI:"https://extensions.penguinmod.com/docs/penguinscript",blocks:[{opcode:"evalStack",blockType:Scratch.BlockType.COMMAND,text:"evaluate [code]",func:"noComp",arguments:{code:{type:Scratch.ArgumentType.STRING,defaultValue:"let x = 5; x = 6 xor 5; global print<x>;"}}},{opcode:"evalReporter",allowDropAnywhere:!0,blockType:Scratch.BlockType.REPORTER,text:"evaluate [code]",func:"noComp",arguments:{code:{type:Scratch.ArgumentType.STRING,defaultValue:"return 69;"}}}]}}noComp(){throw"Please enable compiler."}transpile(e,t,r){return transpile(e,t,r)}getLexer(){return lexer_1.default}getParser(){return parser_1.default}getJSGenerator(){return jsGen_1.default}getGlobalEnv(){return jsGen_1._globalEnv}}Scratch.extensions.register(new ie)}module.exports={Lexer:lexer_1.default,Parser:parser_1.default,JSGenerator:jsGen_1.default,transpile,default:transpile}},19:(e,t)=>{var r,n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.TokenToPrecedence=t.PrecendenceRules=t.Precedence=t.OutputType=t.NodeType=void 0,function(e){e[e.Program=0]="Program",e[e.VariableDeclaration=1]="VariableDeclaration",e[e.AssignmentExpr=2]="AssignmentExpr",e[e.Identifier=3]="Identifier",e[e.PrimitiveLiteral=4]="PrimitiveLiteral",e[e.BinaryExpr=5]="BinaryExpr",e[e.UnaryExpr=6]="UnaryExpr",e[e.StmtBlock=7]="StmtBlock",e[e.IfStatement=8]="IfStatement",e[e.NoOp=9]="NoOp",e[e.ElseStatement=10]="ElseStatement",e[e.While=11]="While",e[e.Function=12]="Function",e[e.Inline=13]="Inline",e[e.ReturnStatement=14]="ReturnStatement",e[e.ArgsList=15]="ArgsList",e[e.FunctionCall=16]="FunctionCall",e[e.Global=17]="Global",e[e.Target=18]="Target",e[e.Break=19]="Break",e[e.Continue=20]="Continue",e[e.Struct=21]="Struct",e[e.Chaining=22]="Chaining"}(r||(t.NodeType=r={})),function(e){e[e.String=0]="String",e[e.Number=1]="Number",e[e.Boolean=2]="Boolean",e[e.Object=3]="Object",e[e.List=4]="List",e[e.VariableReference=5]="VariableReference",e[e.Userdata=6]="Userdata"}(n||(t.OutputType=n={})),function(e){e[e.ASSIGNMENT=0]="ASSIGNMENT",e[e.NOT=1]="NOT",e[e.AND=2]="AND",e[e.XOR=3]="XOR",e[e.OR=4]="OR",e[e.ADDITIVE=5]="ADDITIVE",e[e.MULTIPLICATIVE=6]="MULTIPLICATIVE",e[e.EXPONENTIAL=7]="EXPONENTIAL",e[e.PRIMARY_EXPR=8]="PRIMARY_EXPR"}(s||(t.Precedence=s={})),t.PrecendenceRules={},t.TokenToPrecedence=function(e){return s.ASSIGNMENT}},345:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Token=t.TokenType=void 0,function(e){e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TRUE=2]="TRUE",e[e.FALSE=3]="FALSE",e[e.NULL=4]="NULL",e[e.IDENTIFIER=5]="IDENTIFIER",e[e.LET=6]="LET",e[e.CONST=7]="CONST",e[e.IF=8]="IF",e[e.ELSE=9]="ELSE",e[e.WHILE=10]="WHILE",e[e.FUNCTION=11]="FUNCTION",e[e.RETURN=12]="RETURN",e[e.INLINE=13]="INLINE",e[e.GLOBAL=14]="GLOBAL",e[e.TARGET=15]="TARGET",e[e.BREAK=16]="BREAK",e[e.CONTINUE=17]="CONTINUE",e[e.STRUCT=18]="STRUCT",e[e.EQUALS=19]="EQUALS",e[e.BINARY_OPERATOR=20]="BINARY_OPERATOR",e[e.UNARY_OPERATOR=21]="UNARY_OPERATOR",e[e.SEMICOLON=22]="SEMICOLON",e[e.COMMA=23]="COMMA",e[e.OPEN_PAREN=24]="OPEN_PAREN",e[e.CLOSE_PAREN=25]="CLOSE_PAREN",e[e.OPEN_BRACE=26]="OPEN_BRACE",e[e.CLOSE_BRACE=27]="CLOSE_BRACE",e[e.OPEN_BRACKET=28]="OPEN_BRACKET",e[e.CLOSE_BRACKET=29]="CLOSE_BRACKET",e[e.CHAINING=30]="CHAINING",e[e.RESERVED=31]="RESERVED",e[e.EOF=32]="EOF"}(r||(t.TokenType=r={}));class n{type;raw;constructor(e=r.EOF,t=""){this.type=e,this.raw=t}}t.Token=n,t.default=class{Token=n;TokenType=r;Keywords={let:r.LET,const:r.CONST,and:r.BINARY_OPERATOR,or:r.BINARY_OPERATOR,xor:r.BINARY_OPERATOR,not:r.UNARY_OPERATOR,if:r.IF,else:r.ELSE,false:r.FALSE,true:r.TRUE,null:r.NULL,while:r.WHILE,repeatUntil:r.WHILE,forever:r.WHILE,fn:r.FUNCTION,return:r.RETURN,inline:r.INLINE,global:r.GLOBAL,target:r.TARGET,in:r.RESERVED,for:r.RESERVED,this:r.RESERVED,self:r.RESERVED,struct:r.STRUCT,enum:r.RESERVED,break:r.BREAK,continue:r.CONTINUE};constructor(e){this.src=e,this.srcArr=e.split(""),this.tokens=[]}*yieldToken(e){this.tokens.push(e),yield e}*tokenize(){const e=this.srcArr;for(;e.length>0;)switch(e[0]){case" ":case"\n":case"\r":e.shift();break;case"(":{const t=new n(r.OPEN_PAREN,e.shift());this.tokens.push(t),yield t;break}case")":{const t=new n(r.CLOSE_PAREN,e.shift());this.tokens.push(t),yield t;break}case"{":{const t=new n(r.OPEN_BRACE,e.shift());this.tokens.push(t),yield t;break}case"}":{const t=new n(r.CLOSE_BRACE,e.shift());this.tokens.push(t),yield t;break}case"[":{const t=new n(r.OPEN_BRACKET,e.shift());this.tokens.push(t),yield t;break}case"]":{const t=new n(r.CLOSE_BRACKET,e.shift());this.tokens.push(t),yield t;break}case"-":if(">"===e[1]){yield*this.yieldToken(new n(r.CHAINING,e.shift()+e.shift()));break}case"<":case">":case"+":case"*":case"/":case"%":case"^":{const t=new n(r.BINARY_OPERATOR,e.shift());yield*this.yieldToken(t);break}case"=":{let t;t="="===e[1]?new n(r.BINARY_OPERATOR,e.shift()+e.shift()):new n(r.EQUALS,e.shift()),yield*this.yieldToken(t);break}case";":{const t=new n(r.SEMICOLON,e.shift());yield*this.yieldToken(t);break}case",":{const t=new n(r.COMMA,e.shift());yield*this.yieldToken(t);break}default:if(/^[_a-zA-Z]$/.test(e[0])){let t="";for(;"string"==typeof e[0]&&/^[_a-zA-Z]+[_a-zA-Z0-9]*$/.test(t+e[0])&&e.length>0;t+=e.shift());let s=this.Keywords[t];s?yield*this.yieldToken(new n(s,t)):yield*this.yieldToken(new n(r.IDENTIFIER,t))}else if('"'===e[0]){e.shift();let t="";for(;"string"==typeof e[0]&&'"'!==e[0]&&e.length>0;){const r=e.shift();if("\\"===r){const r=e.shift();switch(r){case"n":t+="\n";break;case"f":t+="\f";break;case"r":t+="\r";break;case"t":t+="\t";break;case"v":t+="\v";break;case"b":t+="\b";break;case"c":{const r=e.shift();if(!r||!/^[a-zA-Z]$/.test(r))throw new SyntaxError(`Expected letter after escape sequence \\c, got ${r||"<EOF>"} instead`);t+=String.fromCodePoint(r.codePointAt(0)||0);break}case"x":{let r,n;if(!/^[0-9a-fA-F]+$/.test((r=e[0])+(n=e[1])))throw new SyntaxError(`Expected two hexadecimal digits after escape sequence \\x, got ${r||"<EOF>"}${r?n||" and <EOF>":""} instead`);t+=String.fromCodePoint(Number("0x"+e.shift()+e.shift()));break}case"u":if(!/^[0-9a-fA-F]+$/.test(e.slice(0,4).join("")))throw new SyntaxError("Invalid Unicode escape sequence, expected 4 hexadecimal digits. ");t+=String.fromCodePoint(Number("0x"+e.shift()+e.shift()+e.shift()+e.shift()));break;case"U":if(!/^[0-9a-fA-F]+$/.test(e.slice(0,6).join("")))throw new SyntaxError("Invalid Unicode escape sequence, expected 6 hexadecimal digits. ");t+=String.fromCodePoint(Number("0x"+e.shift()+e.shift()+e.shift()+e.shift()+e.shift()+e.shift()));break;case"s":t+="üíÄ";break;case"m":t+="üóø";break;case"z":t+="ü•∂";break;case"l":case"T":t+="üê¢";break;case"F":t+="üî•";break;case"S":case"a":t+="‚ú®";break;case"p":t+="üêß";break;case"0":t+="\0";break;default:t+=r||""}}else t+=r}if('"'!==e.shift())throw new SyntaxError("Expected closing quotes, got <EOF> instead.");yield*this.yieldToken(new n(r.STRING,t))}else{let t="";for(;"string"==typeof e[0]&&/^[0-9]+$/.test(t+e[0])&&e.length>0;t+=e.shift());if("."===e[0]&&/^[0-9]$/.test(String(e[1])))for(t+=e.shift(),t+=e.shift();"string"==typeof e[0]&&/^[0-9]+\.[0-9]+$/.test(t+e[0])&&e.length>0;t+=e.shift());yield*this.yieldToken(new n(r.NUMBER,t))}}yield*this.yieldToken(new n)}tokenizeNonGen(){this.tokens=[];const e=[];try{for(const t of this.tokenize())e.push(t)}catch(t){return{error:t,tokens:e}}return{error:null,tokens:e}}src;srcArr;tokens}},56:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(19),s=r(345);t.default=class{constructor(e){if(Array.isArray(e))this.tokens=e;else{const t=new s.default(e).tokenizeNonGen();if(t.error)throw t.error;this.tokens=t.tokens}}tokens=[];not_eof(){return this.tokens[0]?.type!==s.TokenType.EOF}at(){return this.tokens[0]}eat(){return this.tokens.shift()}expect(e){const t=this.eat();if(!t||t.type!==e)throw new SyntaxError(`Expected ${s.TokenType[e]} token, got ${s.TokenType[t?.type]} instead`);return t}produceAST(){const e={kind:n.NodeType.Program,body:[]};for(;this.not_eof();)e.body.push(this.parse_stmt());return e}parse_stmt(){switch(this.at().type){case s.TokenType.LET:case s.TokenType.CONST:return this.parse_variable_declaration();case s.TokenType.OPEN_BRACE:{this.eat();const e=[];for(;this.at().type!==s.TokenType.CLOSE_BRACE&&this.not_eof();){const t=this.parse_stmt();e.push(t)}return this.expect(s.TokenType.CLOSE_BRACE),this.at().type===s.TokenType.SEMICOLON&&this.eat(),{kind:n.NodeType.StmtBlock,body:e}}case s.TokenType.IF:return this.parse_if();case s.TokenType.WHILE:return this.parse_loop();case s.TokenType.ELSE:throw new SyntaxError("Unexpected else statement.");case s.TokenType.SEMICOLON:return this.eat(),{kind:n.NodeType.NoOp};case s.TokenType.RETURN:return this.parse_return();case s.TokenType.BREAK:return this.eat(),{kind:n.NodeType.Break};case s.TokenType.CONTINUE:return this.eat(),{kind:n.NodeType.Continue};default:{const e=this.parse_expr();return this.expect(s.TokenType.SEMICOLON),e}}}parse_return(){this.eat();const e=this.parse_expr();return this.at().type===s.TokenType.SEMICOLON&&this.eat(),{kind:n.NodeType.ReturnStatement,value:e}}parse_function(){let e="";this.eat(),this.at().type===s.TokenType.IDENTIFIER&&(e=this.eat().raw);const t=this.parse_argslist();this.expect(s.TokenType.OPEN_BRACE);const r=[];for(;this.at().type!==s.TokenType.CLOSE_BRACE&&this.not_eof();){const e=this.parse_stmt();r.push(e)}this.expect(s.TokenType.CLOSE_BRACE);const o={kind:n.NodeType.StmtBlock,body:r};return{kind:n.NodeType.Function,args:t,body:o,symbol:e}}parse_argslist(){this.expect(s.TokenType.OPEN_PAREN);const e=[];for(;this.at().type!==s.TokenType.CLOSE_PAREN&&this.not_eof();){let t=this.parse_primary_expr();if(t.kind!==n.NodeType.Identifier)throw new SyntaxError("Expected parameter name.");this.at().type!==s.TokenType.CLOSE_PAREN?this.expect(s.TokenType.COMMA):this.at().type===s.TokenType.COMMA&&this.eat(),e.forEach((e=>{if(e.symbol===t.symbol)throw new SyntaxError("Duplicate parameter name")})),e.push(t)}return this.expect(s.TokenType.CLOSE_PAREN),{kind:n.NodeType.ArgsList,args:e}}parse_inline(){this.eat();const e=this.parse_stmt();if(e.kind===n.NodeType.VariableDeclaration)throw new SyntaxError("Cannot declare a variable in a single-statement context");return{kind:n.NodeType.Inline,body:e}}parse_loop(){switch(this.eat().raw){case"while":return{kind:n.NodeType.While,condition:this.parse_expr(),body:this.parse_stmt()};case"repeatUntil":return{kind:n.NodeType.While,condition:{kind:n.NodeType.UnaryExpr,operand:this.parse_expr(),operator:"not"},body:this.parse_stmt()};case"forever":return{kind:n.NodeType.While,condition:{kind:n.NodeType.PrimitiveLiteral,value:!0},body:this.parse_stmt()}}}parse_if(){this.eat();const e=this.parse_expr(),t=this.parse_stmt();let r;if(this.at().type===s.TokenType.ELSE){this.eat();const s=this.parse_stmt();return r={kind:n.NodeType.ElseStatement,body:s},{kind:n.NodeType.IfStatement,body:t,condition:e,else:r}}return{kind:n.NodeType.IfStatement,body:t,condition:e}}parse_variable_declaration(){const e=this.eat().type===s.TokenType.CONST,t=this.expect(s.TokenType.IDENTIFIER).raw;if(this.at().type===s.TokenType.SEMICOLON){if(this.eat(),e)throw new SyntaxError("Must declare constant with initializer");return{kind:n.NodeType.VariableDeclaration,constant:!1,symbol:t}}this.expect(s.TokenType.EQUALS);const r={kind:n.NodeType.VariableDeclaration,constant:e,symbol:t,value:this.parse_expr()};return this.expect(s.TokenType.SEMICOLON),r}parse_expr(){return this.parse_assignment_expr()}parse_not_expr(){if("not"===this.at().raw&&this.at().type===s.TokenType.UNARY_OPERATOR){this.eat();const e=this.parse_not_expr();return{kind:n.NodeType.UnaryExpr,operand:e,operator:"not"}}return this.parse_additive_expr()}parse_and_expr(){let e=this.parse_xor_expr();for(;"and"===this.at().raw&&this.at().type===s.TokenType.BINARY_OPERATOR;){const t=this.eat().raw,r=this.parse_xor_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_xor_expr(){let e=this.parse_or_expr();for(;"xor"===this.at().raw&&this.at().type===s.TokenType.BINARY_OPERATOR;){const t=this.eat().raw,r=this.parse_or_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_or_expr(){let e=this.parse_relational_expr();for(;"or"===this.at().raw&&this.at().type===s.TokenType.BINARY_OPERATOR;){const t=this.eat().raw,r=this.parse_relational_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_relational_expr(){let e=this.parse_not_expr();for(;("<"===this.at().raw||">"===this.at().raw||"=="===this.at().raw)&&this.at().type===s.TokenType.BINARY_OPERATOR;){let t=this.eat().raw;"<"!==t&&">"!==t||(this.at().type===s.TokenType.EQUALS&&this.eat(),t+="=");const r=this.parse_not_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_assignment_expr(){const e=this.parse_and_expr();if(this.at().type===s.TokenType.EQUALS){this.eat();const t=this.parse_assignment_expr();return{kind:n.NodeType.AssignmentExpr,value:t,assigne:e}}return e}parse_additive_expr(){let e=this.parse_multiplicative_expr();for(;("+"===this.at().raw||"-"===this.at().raw)&&this.at().type===s.TokenType.BINARY_OPERATOR;){const t=this.eat().raw,r=this.parse_multiplicative_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_multiplicative_expr(){let e=this.parse_exponential_expr();for(;("*"===this.at().raw||"/"===this.at().raw||"%"===this.at().raw)&&this.at().type===s.TokenType.BINARY_OPERATOR;){const t=this.eat().raw,r=this.parse_exponential_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_exponential_expr(){let e=this.parse_function_call();for(;"^"===this.at().raw&&this.at().type===s.TokenType.BINARY_OPERATOR;){const t=this.eat().raw,r=this.parse_exponential_expr();e={kind:n.NodeType.BinaryExpr,left:e,right:r,operator:t}}return e}parse_function_call(){let e=this.parse_chaining_expr();for(;this.at().type===s.TokenType.OPEN_PAREN;){this.expect(s.TokenType.OPEN_PAREN);const t=[];for(;this.at().type!==s.TokenType.CLOSE_PAREN&&this.not_eof();){const e=this.parse_expr();this.at().type!==s.TokenType.CLOSE_PAREN?this.expect(s.TokenType.COMMA):this.at().type===s.TokenType.COMMA&&this.eat(),t.push(e)}this.expect(s.TokenType.CLOSE_PAREN),e={kind:n.NodeType.FunctionCall,func:e,args:t}}return e}parse_chaining_expr(){let e=this.parse_primary_expr();for(;this.at().type===s.TokenType.CHAINING;){this.eat();let t="";t=this.at().type===s.TokenType.STRING?this.eat().raw:this.expect(s.TokenType.IDENTIFIER).raw,e={kind:n.NodeType.Chaining,item:e,index:t}}return e}parse_struct(){this.eat(),this.expect(s.TokenType.OPEN_BRACKET);const e=[];for(;this.at().type!==s.TokenType.CLOSE_BRACKET;){let t="";t=this.at().type===s.TokenType.STRING?this.eat().raw:this.expect(s.TokenType.IDENTIFIER).raw;let r=null;this.at().type===s.TokenType.EQUALS&&(this.eat(),r=this.parse_expr()),this.expect(s.TokenType.SEMICOLON),e.forEach((e=>{if(t===e[0])throw new SyntaxError("Duplicate member name in struct.")})),e.push([t,r])}return this.expect(s.TokenType.CLOSE_BRACKET),{kind:n.NodeType.Struct,body:e}}parse_primary_expr(){const e=this.at().type;switch(e){case s.TokenType.IDENTIFIER:return{kind:n.NodeType.Identifier,symbol:this.eat().raw};case s.TokenType.GLOBAL:if(this.eat(),this.at().type!==s.TokenType.IDENTIFIER)throw new SyntaxError("Expected identifier after keyword global");return{kind:n.NodeType.Global,symbol:this.eat().raw};case s.TokenType.TARGET:return this.eat(),{kind:n.NodeType.Target};case s.TokenType.NUMBER:return{kind:n.NodeType.PrimitiveLiteral,value:Number(this.eat().raw)};case s.TokenType.STRING:return{kind:n.NodeType.PrimitiveLiteral,value:this.eat().raw};case s.TokenType.TRUE:return this.eat(),{kind:n.NodeType.PrimitiveLiteral,value:!0};case s.TokenType.FALSE:return this.eat(),{kind:n.NodeType.PrimitiveLiteral,value:!1};case s.TokenType.NULL:return this.eat(),{kind:n.NodeType.PrimitiveLiteral,value:null};case s.TokenType.OPEN_PAREN:{this.eat();const e=this.parse_expr();return this.expect(s.TokenType.CLOSE_PAREN),e}case s.TokenType.FUNCTION:return this.parse_function();case s.TokenType.STRUCT:return this.parse_struct();case s.TokenType.INLINE:return this.parse_inline();case s.TokenType.RESERVED:throw new SyntaxError(`Unexpected reserved word ${this.at().raw}`);default:throw new SyntaxError(`Invalid or unexpected token ${s.TokenType[e]}.`)}}}},134:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._globalEnv=t.VariablePool=t.OutputType=void 0;const n=r(19);var s;!function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_STRING=1]="TYPE_STRING",e[e.TYPE_BOOLEAN=2]="TYPE_BOOLEAN",e[e.TYPE_UNKNOWN=3]="TYPE_UNKNOWN"}(s||(t.OutputType=s={}));class o{src;type;isAlwaysNumber(){return this.type===s.TYPE_NUMBER}isAlwaysString(){return this.type===s.TYPE_STRING}asNumber(){return this.isAlwaysNumber()?this.src:`Number(${this.src})`}asString(){return this.isAlwaysString()?this.src:`String(${this.src})`}asBoolean(){return`((${this.src} ?? false) === false)`}asUnknown(){return`(${this.src} ?? null)`}asIdent(){return`(${this.src})`}constructor(e,t){this.src=e,this.type=t}}class i{constantValue;constructor(e){this.constantValue=e}isAlwaysNumber(){return"number"==typeof this.constantValue}isAlwaysString(){return"string"==typeof this.constantValue}asNumber(){return this.isAlwaysNumber()?this.constantValue.toString():Number(this.constantValue).toString()}asString(){return this.isAlwaysString()?JSON.stringify(this.constantValue):JSON.stringify(this.constantValue.toString())}asBoolean(){return"boolean"==typeof this.constantValue?this.constantValue.toString():(!1===(this.constantValue??!1)).toString()}asUnknown(){switch(typeof this.constantValue){case"number":return this.asNumber();case"boolean":return this.asBoolean();case"object":if(this.constantValue)throw new Error("Unexpected Object.");return"null";default:return this.asString()}}asIdent(){return"(null)"}}function*a(e){let t=0;for(;;)yield e+t++}t.VariablePool=a;const c=a("s");t._globalEnv={__env:new Map,__readonly:new Map,makeReadOnly:function(e){return this.__readonly.set(e,!0)},readOnly:function(e){return this.__readonly.get(e)},set:function(e,t){if(this.__readonly.get(e))throw new TypeError("Attempted to overwrite read-only global");return this.__env.set(e,t),t},remove:function(e){if(this.__readonly.get(e))throw new TypeError("Attempted to remove read-only global");return this.__env.delete(e)},get:function(e){return this.__env.get(e)??(this.__env.set(e,{value:null}),this.__env.get(e))}};const u=function*(){}.constructor;class l{static CompilerSettings={referenceErrors:!0};program;src="let _;let _2;let _3;let _4;let _5; let _6; let_7;";scriptName;_variablePool;_cachedVariables;static _globalEnv=t._globalEnv;warpTimer;isWarp;yields;constructor(e){this.program=e,this.scriptName=c.next().value,this._variablePool=a("v"),this._cachedVariables={__proto__:null}}transpile(e,t,r,n){const s=this.program;this.warpTimer=r,this.isWarp=n,this.yields=t;for(const e of s.body)this.descendNode(e);switch(this.src=`try{${this.src}}catch(error){if(error?.isExit)return error?.returnValue;throw error};`,e){case"string":return this.src;case"func":return new Function("$globalEnv","$target","isStuck",this.src);case"generator":return new u("$globalEnv","$target","isStuck",this.src)}}yielded(){if(!this.yields)throw new Error("Script yielded but is not marked as yielding")}yieldLoop(){this.yields&&(this.warpTimer?(this.isWarp?this.src+="if (isStuck()) yield;":this.src+="yield;",this.yielded()):this.isWarp||(this.src+="yield;",this.yielded()))}getVariable(e){if(this._cachedVariables[e])return this._cachedVariables[e];const t=this._variablePool.next().value;return this._cachedVariables[e]=t}descendNode(e){switch(e.kind){case n.NodeType.NoOp:break;case n.NodeType.StmtBlock:{const t=e;this.src+="{";for(const e of t.body)this.descendNode(e);this.src+="}";break}case n.NodeType.ReturnStatement:{const t=e;this.src+="return(",this.src+=this.descendExpr(t.value).asUnknown(),this.src+=")",this.src+="?? null;";break}case n.NodeType.IfStatement:{const t=e;if(this.src+="if(",this.src+=this.descendExpr(t.condition).asBoolean(),this.src+=")",t.body.kind===n.NodeType.VariableDeclaration)throw new SyntaxError("Cannot declare a variable in a single-statement context");if(this.descendNode(t.body),t.else){if(this.src+="else ",t.else.body.kind===n.NodeType.VariableDeclaration)throw new SyntaxError("Cannot declare a variable in a single-statement context");this.descendNode(t.else.body)}this.src+=";";break}case n.NodeType.VariableDeclaration:{const t=e,r=this.getVariable(t.symbol);if(t.constant?this.src+="const ":this.src+="let ",this.src+=r,t.value){const e=this.descendExpr(t.value);this.src+="=",this.src+="{value:",this.src+=e.asUnknown(),this.src+="}"}this.src+=";";break}case n.NodeType.While:{const t=e;if(this.src+="while(",this.src+=this.descendExpr(t.condition).asBoolean(),this.src+="){",t.body.kind===n.NodeType.VariableDeclaration)throw new SyntaxError("Cannot declare a variable in a single-statement context");this.descendNode(t.body),this.yieldLoop(),this.src+="};"}case n.NodeType.Break:this.src+="break;";case n.NodeType.Continue:this.src+="continue;";default:{const t=this.descendExpr(e);this.src+=t.asUnknown(),this.src+=";"}}}descendExpr(e){switch(e.kind){case n.NodeType.Global:{const t=e;return new o(`($globalEnv.get(${JSON.stringify(t.symbol)}).value)`,s.TYPE_UNKNOWN)}case n.NodeType.AssignmentExpr:{const t=e;if(t.assigne.kind!==n.NodeType.Identifier&&t.assigne.kind!==n.NodeType.Global&&t.assigne.kind!==n.NodeType.Chaining)throw new SyntaxError("Invalid left-hand in assignment");const r=this.descendExpr(t.assigne),i=this.descendExpr(t.value);return new o(`((${r.asIdent()}) = (${i.asUnknown()}))`,s.TYPE_UNKNOWN)}case n.NodeType.UnaryExpr:{const t=e,r=this.descendExpr(t.operand);if("not"===t.operator)return new o(`(!(${r.asBoolean()}))`,s.TYPE_BOOLEAN);throw new SyntaxError("Unknown unary operator")}case n.NodeType.BinaryExpr:{const t=e;switch(t.operator){case"and":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(_ = ${e.asUnknown()}, _2 = ${r.asUnknown()}, (((_ ?? false) === false) && !((_2 ?? false) === false)) ? _ : _2)`,s.TYPE_UNKNOWN)}case"xor":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(_ = ${e.asUnknown()}, _2 = ${r.asUnknown()}, (((_ ?? false) === false) && !((_2 ?? false) === false)) ? _2 : (((_2 ?? false) === false) && !((_ ?? false) === false)) ? _ : (!((_2 ?? false) === false) && !((_ ?? false) === false)) ? false : _2)`,s.TYPE_UNKNOWN)}case"or":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(_ = ${e.asUnknown()}, _2 = ${r.asUnknown()}, (!((_ ?? false) === false) ? _ : _2)`,s.TYPE_UNKNOWN)}case"<":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} < ${r.asNumber()})`,s.TYPE_BOOLEAN)}case">":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} > ${r.asNumber()})`,s.TYPE_BOOLEAN)}case"<=":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} <= ${r.asNumber()})`,s.TYPE_BOOLEAN)}case">=":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} >= ${r.asNumber()})`,s.TYPE_BOOLEAN)}case"==":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(Object.is(${e.asUnknown()}, ${r.asUnknown()}))`,s.TYPE_BOOLEAN)}case"+":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} + ${r.asNumber()})`,s.TYPE_NUMBER)}case"-":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} - ${r.asNumber()})`,s.TYPE_NUMBER)}case"*":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} * ${r.asNumber()})`,s.TYPE_NUMBER)}case"/":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} / ${r.asNumber()})`,s.TYPE_NUMBER)}case"%":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} % ${r.asNumber()})`,s.TYPE_NUMBER)}case"^":{const e=this.descendExpr(t.left),r=this.descendExpr(t.right);return new o(`(${e.asNumber()} ** ${r.asNumber()})`,s.TYPE_NUMBER)}}}case n.NodeType.PrimitiveLiteral:{const t=e.value;return new i(t)}case n.NodeType.Identifier:{const t=e,r=this.getVariable(t.symbol);let n;return n=l.CompilerSettings.referenceErrors?`if(e instanceof ReferenceError){throw new ReferenceError("${r} is not defined.")};throw e;`:`if(e instanceof ReferenceError){return {get value(){return null},set value(v){throw new ReferenceError("${r} is not defined.")}}};throw e;`,new o(`(((function(){try{if(${r}===globalThis.${r}||typeof ${r}!=="object")throw new ReferenceError("");return ${r}}catch(e){${n}}})()).value)`,s.TYPE_UNKNOWN)}case n.NodeType.Inline:{const t=e;let r="";const n=this.src;this.src="",this.descendNode(t.body);const i=this.src;return this.src=n,this.yields?r+="(yield*(function*(){":r+="(function(){",r+=i,r+="})()",this.yields&&(r+=")"),new o(`(${r})`,s.TYPE_UNKNOWN)}case n.NodeType.Function:{const t=e,r=t.args.args,n=this.src;this.src="",this.descendNode(t.body);const i=this.src;this.src=n;let a="";for(const e of r)a+=this.getVariable(e.symbol),a+=",";let c=t.symbol??"";return c&&(c=this.getVariable(t.symbol)),new o(`(function*${c}(${a}){${i}})`,s.TYPE_UNKNOWN)}case n.NodeType.FunctionCall:{const t=e,r=this.descendExpr(t.func).asUnknown(),n=[];for(const e of t.args)n.push(this.descendExpr(e).asUnknown());return new o(`((yield* ${r}(${n.join(",")})) ?? null)`,s.TYPE_UNKNOWN)}case n.NodeType.Chaining:{const t=e,r=this.descendExpr(t.item).asUnknown(),n=`(function(){if(!(_3?.props&&_3?.isStruct))throw new TypeError("Can only use chaining operator on struct instances.");if(!_3.props[${JSON.stringify(t.index)}]){throw new TypeError("Struct does not have property, cannot chain.")};}()`;return new o(`((_3 = ${r}, ${n}, _3).props[${JSON.stringify(t.index)}].value)`,s.TYPE_UNKNOWN)}case n.NodeType.Struct:{const t=e;let r="(function*(){const struct = {__proto__: null,isStruct: true,props:{__proto__:null}};";for(const e of t.body){r+=`struct.props[${JSON.stringify(e[0])}]={value:`;let t="(null)";if(e[1]){const r=e[1];t=r.kind===n.NodeType.Function?`(function*(storedFunc){return function*(...args){return yield*(storedFunc)(struct, ...args)}})(${this.descendExpr(r).src})`:this.descendExpr(r).asUnknown()}r+=`${t}};`}return r+="return struct;})",new o(`(${r})`,s.TYPE_UNKNOWN)}case n.NodeType.Target:return new o("($target)",s.TYPE_UNKNOWN)}}}t.default=l}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}var __webpack_exports__=__webpack_require__(156);return __webpack_exports__})()));
